import web_tools
import random
import time
import threading


def snapshot():

    for i in range(999):

        if random.choice(range(2)) == 0:
            print('''
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒░░░░░░░░░░▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓▓▓▓▓░░░░▒▒▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓░░▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░            ░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░                          ░░░░░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓██████████████████████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░          ░░░░░░░░░░░░            ░░░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒████████████████████████████████▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░      ░░░░░░░░░░░░░░░░░░░░░░░░        ░░░░░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒████████████████████████████████▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░        ▒▒░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒████████████████████████████████▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░      ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░        ░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒██████████████████████████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ░░░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓██████████████████████████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒    ░░░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒▓▓██████████████████████████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ░░▒▒▒▒▒▒░░      ░░▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░    ░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒████████████████████████████████████▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ▒▒▒▒▒▒▒▒░░      ▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    ░░
░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓██████████████████████████████▓▓▓▓▓▓▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░    ▒▒▒▒▒▒▒▒        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    ░░
░░▒▒░░▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░  ▒▒▒▒▒▒▒▒▒▒          ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██░░░░    ▒▒▒▒▒▒▒▒▒▒        ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▒▒░░░░    ▒▒▒▒▒▒▒▒▒▒        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▒▒▒▒▒▒▒▒▓▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▓▓▓▓▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████▓▓▒▒▒▒▒▒▒▒▒▒░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒      ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓████████████████████▓▓▓▓██████████████████▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░▒▒    ▒▒▒▒▒▒▒▒▒▒▒▒░░      ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓██████████████████████████████████████████▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒        ▒▒▒▒▒▒▒▒▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓████████████████████████████████████▓▓████▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░      ░░▒▒▒▒        ▒▒▒▒▒▒▒▒▒▒▒▒    
░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓████          ▓▓████▒▒░░        ░░██▒▒████▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░  ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░                    ▒▒▒▒▒▒▒▒░░    
░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓████░░      ░░██████▓▓          ░░░░██████▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                  ▒▒▒▒▒▒▒▒    ░░
░░▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████        ░░██████▒▒          ████████▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░            ░░▒▒▒▒▒▒▒▒    ▒▒
░░▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████▓▓████████████████▓▓████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░▒▒▒▒░░░░░░▒▒▒▒▒▒▒▒▒▒      ░░
░░▒▒▒▒▒▒▒▒▒▒▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░    ▒▒░░░░░░░░░░░░░░░░▒▒░░░░░░░░░░░░░░░░░░░░░░    ░░░░
░░░░▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒░░░░░░░░    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒      ░░░░
░░░░▒▒▒▒▒▒▓▓████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒░░░░░░░░░░    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▒▒        ░░░░░░
░░░░░░░░▓▓▓▓▓▓██████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒░░░░░░░░░░░░    ▒▒░░░░    ░░░░░░░░░░░░░░░░░░░░░░░░░░        ░░░░░░░░
░░░░░░░░▓▓▓▓██████████████████████████████████████████████████████████████████████▓▓▓▓▓▓░░░░░░░░░░░░░░    ░░            ░░░░░░░░░░░░░░░░░░          ░░░░░░░░░░
░░░░░░░░▒▒▓▓▓▓████████████████████████████████████████████████████████████████████▓▓▓▓▒▒░░░░░░░░░░░░░░                                          ░░▒▒░░░░░░░░░░
░░░░░░░░▒▒▒▒▓▓████████████████████████████████████████████████████████████████████▓▓██▒▒░░░░░░░░░░░░          ░░▒▒░░                          ░░░░░░░░░░░░░░░░
░░░░░░░░▒▒▒▒██▓▓████████████████████████████████████████████████████████████████▓▓████▒▒░░░░░░░░░░░░      ░░░░░░░░░░░░░░                ░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░▒▒▓▓████▓▓▓▓██████████████████████████████████████████████████████████▓▓▓▓████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░▒▒██████████▓▓████████████████████████████████████████████████████▓▓▓▓██████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░▒▒████████████▓▓████████████████████████████████████████████████▓▓██████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░▓▓██████▓▓▓▓▓▓▓▓▓▓▓▓██████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓██████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░██████████▓▓██████▓▓████████████████████████████████████████████████▓▓▓▓████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░████████████▓▓▓▓██████████████████████████████████████████████████▓▓████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
░░░░░░░░████████████████████████████████████████████████████████████████▓▓██████████████▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
            ''')
            print(f'searching... - {i+1} ')
            print('\u001b[34m Guess which play?')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n \u001b[0m')

        else:
            print(f'{i+1} --- ô¿ô searching...')
            print('\u001b[34m Where did I find these?')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n \u001b[0m')

        try:
            df5 = t1.get_string_query('china', pages=1)
            t1.df_to_db(id = t1.response.headers['x-transaction-id'], data = df5, type = 'query', query_term = t1.query_log[len(t1.query_log)-1]['parsed_query_term'])
            print(f'\u001b[31;1m A sample from {t1.query_log[len(t1.query_log)-1]["parsed_query_term"]}\u001b[0m')
            print(df5.iloc[random.choice(range(len(df5)))]['text'])

            df6 = t1.get_string_query('musk', pages=1)
            t1.df_to_db(id = t1.response.headers['x-transaction-id'], data = df6, type = 'query', query_term = t1.query_log[len(t1.query_log)-1]['parsed_query_term'])
            print(f'\u001b[31;1m A little helping of {t1.query_log[len(t1.query_log)-1]["parsed_query_term"]}\u001b[0m')
            print(df6.iloc[random.choice(range(len(df6)))]['text'])

            df7 = t1.get_string_query('russia', pages=1)
            t1.df_to_db(id = t1.response.headers['x-transaction-id'], data = df7, type = 'query', query_term = t1.query_log[len(t1.query_log)-1]['parsed_query_term'])
            print(f'\u001b[31;1m A bit of the last one-hundred tweets about {t1.query_log[len(t1.query_log)-1]["parsed_query_term"]}\u001b[0m')
            print(df7.iloc[random.choice(range(len(df7)))]['text'])

            df8 = t1.get_string_query('biden', pages=1)
            t1.df_to_db(id = t1.response.headers['x-transaction-id'], data = df8, type = 'query', query_term = t1.query_log[len(t1.query_log)-1]['parsed_query_term'])
            print(f'\u001b[31;1m Are you sure you want to read about {t1.query_log[len(t1.query_log)-1]["parsed_query_term"]}?\u001b[0m')
            print(df8.iloc[random.choice(range(len(df8)))]['text'])

            print(f'zzZ~still~zzZZ ([-_-]) Zzz~sleeping~zz... -25228 s....')
            global sleeping_timer_start
            sleeping_timer_start = time.time()
            time.sleep(25228)  # one snapshot per 7 hours
        except KeyError as err:
            print(f'Caught KeyError, checking headers...{err}')
            if t1.response.json()['title'] == 'UsageCapExceeded':
                print('Usage cap exceeded! exiting')
                break

        if random.choice(range(2)) == 0:
            print('\u001b[34m Still there?')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n')
            print(web_tools.random_line())
            print('\n \u001b[0m')


        if random.choice(range(2)) == 0:
            print(f'sleeping (-.-)Zzz...{i+1}')
        else:
            print('[{-_-}] ZZZzz zz z... sleeping')

        print(t1.limit_log)

def timer():

    for i in range(999):

        print('Thread time:', time.thread_time())
        time.sleep(120)

t1 = web_tools.Twitter_Session()
t1.get_token_local('keys.json')

sleeping_timer_start = 0.0

snapshot_thread = threading.Thread(target=snapshot)
timer_thread = threading.Thread(target=timer)

snapshot_thread.start()
timer_thread.start()